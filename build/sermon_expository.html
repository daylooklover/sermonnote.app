<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“– ê°•í•´ì„¤êµ ì‘ì„±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    textarea, input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    #bible-area {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      user-select: text;
    }
    #result-box {
      margin: 10px 0;
      padding: 10px;
      background-color: #333;
      border-radius: 8px;
    }
    button {
      padding: 10px 16px;
      margin: 10px 6px 0 0;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    .insert-btn { background-color: #007b7f; color: white; }
    .save-btn { background-color: darkgreen; color: white; }
    .print-btn { background-color: darkred; color: white; }
    .ai-btn { background-color: #4444aa; color: white; }
  </style>
</head>
<body>

  <h1>ğŸ“– ê°•í•´ì„¤êµ ì‘ì„±</h1>

  <label>ì„¤êµ ì œëª©</label>
  <input id="title" type="text" placeholder="ì˜ˆ: ì°½ì„¸ê¸° 1ì¥ì˜ ë³µìŒì  ì˜ë¯¸" />

  <label>ë³¸ë¬¸ ì„±ê²½êµ¬ì ˆ</label>
  <div id="bible-area">
    íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼. (ì°½ì„¸ê¸° 1:1)
  </div>

  <div id="result-box" style="display:none;">
    <strong>ğŸ§  AI ë¶„ì„ ê²°ê³¼:</strong>
    <p id="ai-output"></p>
    <button class="insert-btn" onclick="insertToBody()">ë³¸ë¬¸ì— ì¶”ê°€</button>
  </div>

  <label>ì„¤êµ ë‚´ìš©</label>
  <textarea id="body" rows="10" placeholder="ë³¸ë¬¸ì— ëŒ€í•œ ì„¤êµ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>

  <!-- AI ë²„íŠ¼ë“¤ -->
  <div>
    <button class="ai-btn" onclick="summarize()">âœ‚ ìš”ì•½</button>
    <button class="ai-btn" onclick="correctGrammar()">ğŸ”¤ ë¬¸ë²• êµì •</button>
    <button class="ai-btn" onclick="generateStructure()">ğŸ§  ì„¤êµ êµ¬ì¡° ìƒì„±</button>
  </div>

  <div>
    <button class="save-btn" onclick="saveSermon()">ì €ì¥</button>
    <button class="print-btn" onclick="window.print()">ì¸ì‡„</button>
  </div>

  <script>
    const aiEndpoint = "/ai"; // âœ… ìˆ˜ì • ì™„ë£Œ

    document.getElementById('bible-area').addEventListener('mouseup', async () => {
      const selectedText = window.getSelection().toString().trim();
      if (selectedText.length > 0) {
        document.getElementById('ai-output').textContent = "ğŸ”„ ë¶„ì„ ì¤‘...";
        document.getElementById('result-box').style.display = 'block';
        try {
          const res = await fetch(aiEndpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              prompt: `í—¬ë¼ì–´/íˆë¸Œë¦¬ì–´ ë˜ëŠ” ì£¼ì„ ê´€ì ì—ì„œ "${selectedText}"ì— ëŒ€í•´ ì„¤ëª…í•´ì¤˜.`,
              role: "exegesis"
            })
          });
          const data = await res.json();
          document.getElementById('ai-output').textContent = data.result;
        } catch (err) {
          document.getElementById('ai-output').textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + err;
        }
      }
    });

    function insertToBody() {
      const explanation = document.getElementById('ai-output').textContent;
      const textarea = document.getElementById('body');
      textarea.value += "\n\nğŸ“Œ ì£¼ì„: " + explanation;
    }

    function saveSermon() {
      const title = document.getElementById('title').value;
      const body = document.getElementById('body').value;
      alert("âœ… ì„¤êµê°€ ë¡œì»¬ì— ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      localStorage.setItem("sermonTitle", title);
      localStorage.setItem("sermonBody", body);
    }

    async function callAI(prompt) {
      const res = await fetch(aiEndpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });
      const data = await res.json();
      return data.result;
    }

    async function summarize() {
      const content = document.getElementById("body").value;
      const result = await callAI("ë‹¤ìŒ ì„¤êµë¥¼ ìš”ì•½í•´ì¤˜:\n" + content);
      alert("âœ‚ ìš”ì•½ ê²°ê³¼:\n" + result);
    }

    async function correctGrammar() {
      const content = document.getElementById("body").value;
      const result = await callAI("ë‹¤ìŒ ì„¤êµì˜ ë¬¸ë²•ê³¼ í‘œí˜„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ìˆ˜ì •í•´ì¤˜:\n" + content);
      document.getElementById("body").value = result;
      alert("ğŸ”¤ ë¬¸ë²• êµì • ì™„ë£Œ!");
    }

    async function generateStructure() {
      const title = document.getElementById("title").value;
      const scripture = document.getElementById("bible-area").innerText;
      const result = await callAI(`"${title}"ë¼ëŠ” ì£¼ì œì™€ "${scripture}" ë³¸ë¬¸ìœ¼ë¡œ ì„¤êµ ê°œìš”ë¥¼ ë§Œë“¤ì–´ì¤˜.`);
      alert("ğŸ§  ì„¤êµ êµ¬ì¡°:\n" + result);
    }
  </script>

</body>
</html>
