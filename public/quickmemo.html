<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>í€µë©”ëª¨ ì‘ì„± ë° ê´€ë¦¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');
  body {
    margin:0; padding:20px;
    font-family:'Nanum Gothic', sans-serif;
    background: linear-gradient(135deg, #1c1c2b, #28313b);
    color:#f0e6d2;
    min-height: 100vh;
  }
  h2 {
    text-align: center;
    color: #ffeb3b;
    text-shadow: 0 0 8px #ffd54f;
  }
  #quickmemoSearch {
    width: 100%;
    max-width: 600px;
    padding: 10px;
    font-size: 1.1rem;
    border-radius: 12px;
    border: none;
    outline: none;
    margin: 20px auto;
    display: block;
    box-shadow: 0 0 10px #ffc107aa inset;
    background: #222;
    color: #eee;
  }
  #quickmemoList {
    max-width: 600px;
    margin: 0 auto;
    background: #222;
    border-radius: 14px;
    box-shadow: 0 0 25px #ffc107cc;
    padding: 12px;
    max-height: 300px;
    overflow-y: auto;
  }
  .quickmemo-item {
    padding: 12px 16px;
    margin-bottom: 8px;
    background: #333;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease, border-left 0.3s ease;
  }
  .quickmemo-item:hover {
    background: #444;
  }
  .quickmemo-item.selected {
    background-color: #ffeb3b;
    color: #222;
    font-weight: 700;
    border-left: 6px solid #fbc02d;
  }
  #sermonContent {
    width: 100%;
    max-width: 600px;
    margin: 20px auto 10px;
    padding: 16px;
    font-size: 1.1rem;
    border-radius: 14px;
    border: none;
    resize: vertical;
    min-height: 140px;
    box-shadow: 0 0 20px #ffc107cc inset;
    background: #1e1e2a;
    color: #eee;
    outline: none;
    display: block;
  }
  .btn-row {
    max-width: 600px;
    margin: 0 auto 40px;
    display: flex;
    gap: 14px;
    justify-content: center;
    flex-wrap: wrap;
  }
  button {
    background: #ffea00;
    color: #222;
    border: none;
    border-radius: 16px;
    padding: 14px 28px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(253,216,53,0.8);
    transition: background-color 0.3s ease, transform 0.15s ease;
  }
  button:hover {
    background-color: #fff176;
    transform: scale(1.05);
  }
  button:active {
    transform: scale(0.95);
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  @media (max-width: 480px) {
    #sermonContent {
      font-size: 1rem;
      min-height: 120px;
    }
    button {
      padding: 12px 20px;
      font-size: 1rem;
    }
  }
</style>
</head>
<body>

<h2>âœ í€µë©”ëª¨ ì‘ì„± ë° ê´€ë¦¬</h2>

<input type="text" id="quickmemoSearch" placeholder="í€µë©”ëª¨ ê²€ìƒ‰..." autocomplete="off" />

<div id="quickmemoList"></div>

<textarea id="sermonContent" placeholder="ì—¬ê¸°ì— ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>

<div class="btn-row">
  <button id="startRecordBtn">ğŸ™ ìŒì„± ë…¹ìŒ ì‹œì‘</button>
  <button id="stopRecordBtn" disabled>â–  ë…¹ìŒ ì¤‘ì§€</button>
  <button id="editBtn">ìˆ˜ì •í•˜ê¸°</button>
  <button id="saveBtn">ì €ì¥í•˜ê¸°</button>
</div>

<script>
  const quickmemoSearchInput = document.getElementById('quickmemoSearch');
  const quickmemoList = document.getElementById('quickmemoList');
  const sermonContent = document.getElementById('sermonContent');
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const startRecordBtn = document.getElementById('startRecordBtn');
  const stopRecordBtn = document.getElementById('stopRecordBtn');

  let quickmemos = JSON.parse(localStorage.getItem('quickmemos') || '["í•˜ë‚˜ë‹˜ì˜ ì€í˜œëŠ” ë¬´í•œí•©ë‹ˆë‹¤.","ë¯¿ìŒì€ ì‹œë ¨ì„ ê²¬ë””ê²Œ í•©ë‹ˆë‹¤.","ì‚¬ë‘ì€ ëª¨ë“  ê²ƒì„ ì´ê¹ë‹ˆë‹¤."]');

  let selectedIndex = null;

  function renderList(list) {
    quickmemoList.innerHTML = "";
    list.forEach((item, idx) => {
      const div = document.createElement("div");
      div.textContent = item;
      div.className = "quickmemo-item";
      if (idx === selectedIndex) div.classList.add("selected");
      div.dataset.idx = idx;
      quickmemoList.appendChild(div);
    });
  }

  quickmemoList.addEventListener("click", (e) => {
    if (e.target && e.target.dataset.idx !== undefined) {
      selectedIndex = Number(e.target.dataset.idx);
      renderList(quickmemos);
      sermonContent.value = quickmemos[selectedIndex];
    }
  });

  editBtn.addEventListener("click", () => {
    if (selectedIndex === null) {
      alert("ìˆ˜ì •í•  í€µë©”ëª¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    sermonContent.value = quickmemos[selectedIndex];
  });

  saveBtn.addEventListener("click", () => {
    const newText = sermonContent.value.trim();
    if (!newText) {
      alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    if (selectedIndex === null) {
      // ìƒˆ ë©”ëª¨ ì¶”ê°€ ì‹œ ìµœëŒ€ 5ê°œ ì œí•œ
      if (quickmemos.length >= 5) {
        alert("í€µë©”ëª¨ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }
      quickmemos.push(newText);
      selectedIndex = quickmemos.length - 1;
    } else {
      // ê¸°ì¡´ ë©”ëª¨ ìˆ˜ì •
      quickmemos[selectedIndex] = newText;
    }

    renderList(quickmemos);
    localStorage.setItem('quickmemos', JSON.stringify(quickmemos));

    alert("í€µë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
  });

  quickmemoSearchInput.addEventListener("input", () => {
    const keyword = quickmemoSearchInput.value.trim();
    if (keyword.length > 0) {
      const filtered = quickmemos.filter(qm => qm.includes(keyword));
      selectedIndex = null;
      sermonContent.value = "";
      renderList(filtered);
    } else {
      selectedIndex = null;
      sermonContent.value = "";
      renderList(quickmemos);
    }
  });

  // ìŒì„± ì¸ì‹ ì„¤ì • ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
  let recognition;
  let isRecording = false;
  let recognizedText = '';

  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();

    recognition.lang = 'ko-KR'; // í•œêµ­ì–´ ì„¤ì •
    recognition.interimResults = true;
    recognition.continuous = false;

    recognition.onstart = () => {
      isRecording = true;
      startRecordBtn.disabled = true;
      stopRecordBtn.disabled = false;
    };

    recognition.onerror = (event) => {
      console.error('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
      alert('ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + event.error);
      stopRecording();
    };

    recognition.onresult = (event) => {
      let interimTranscript = '';
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          recognizedText += event.results[i][0].transcript;
        } else {
          interimTranscript += event.results[i][0].transcript;
        }
      }
      sermonContent.value = recognizedText + interimTranscript;
    };

    recognition.onend = () => {
      isRecording = false;
      startRecordBtn.disabled = false;
      stopRecordBtn.disabled = true;

      if (recognizedText.trim().length > 0) {
        if (quickmemos.length >= 5) {
          alert("í€µë©”ëª¨ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }
        selectedIndex = quickmemos.length;
        quickmemos.push(recognizedText.trim());
        renderList(quickmemos);
        sermonContent.value = recognizedText.trim();

        alert('ë…¹ìŒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
      }
    };
  } else {
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    startRecordBtn.disabled = true;
    stopRecordBtn.disabled = true;
  }

  function startRecording() {
    recognizedText = '';
    recognition.start();
  }

  function stopRecording() {
    recognition.stop();
  }

  startRecordBtn.addEventListener('click', startRecording);
  stopRecordBtn.addEventListener('click', stopRecording);

  renderList(quickmemos);
</script>

</body>
</html>
