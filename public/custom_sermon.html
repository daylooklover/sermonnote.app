<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì„±ê²½ ë§ì”€ì„ í†µí•œ ì„¤êµ ì‘ì„±</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');

  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Nanum Gothic', sans-serif;
    background: linear-gradient(135deg, #1c1c2b, #28313b);
    color: #f0e6d2;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .container {
    flex: 1;
    display: flex;
    gap: 20px;
    padding: 30px;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* ì™¼ìª½ ì‚¬ì´ë“œ */
  .left-panel {
    width: 360px;
    background: rgba(30,30,42,0.85);
    border-radius: 24px;
    padding: 30px;
    box-shadow:
      0 8px 24px rgba(0,0,0,0.6),
      inset 0 0 50px rgba(255,238,138,0.15);
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .left-panel label {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 8px;
    color: #ffe57f;
    text-shadow: 0 0 8px #ffd54f;
  }

  .left-panel input[type="text"],
  .left-panel select {
    padding: 12px 15px;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  .left-panel input[type="text"]:focus,
  .left-panel select:focus {
    box-shadow: 0 0 10px #ffd54f;
  }

  /* ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ */
  .right-panel {
    flex: 1;
    background: rgba(30,30,42,0.85);
    border-radius: 24px;
    padding: 30px;
    box-shadow:
      0 8px 24px rgba(0,0,0,0.6),
      inset 0 0 50px rgba(255,238,138,0.15);
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .right-panel label {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #ffe57f;
    text-shadow: 0 0 8px #ffd54f;
  }

  .right-panel textarea {
    flex: 1;
    padding: 20px;
    font-size: 1.1rem;
    border-radius: 16px;
    border: none;
    resize: none;
    background: #1e1e2a;
    color: #eee;
    outline: none;
    box-shadow: inset 0 0 15px #ffc10744;
    transition: box-shadow 0.3s ease;
  }
  .right-panel textarea:focus {
    box-shadow: inset 0 0 25px #ffd54faa;
  }

  /* ìŒì„±ì¸ì‹ ë§ˆì´í¬ ë²„íŠ¼ */
  #micBtn {
    position: absolute;
    top: 30px;
    right: 30px;
    background-color: #ffeb3b;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(251, 192, 45, 0.8);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    z-index: 10;
  }
  #micBtn.active {
    background-color: #f44336;
    box-shadow: 0 8px 30px rgba(244, 67, 54, 0.9);
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
    70% { box-shadow: 0 0 0 12px rgba(244, 67, 54, 0); }
    100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
  }
  #micIcon {
    width: 28px;
    height: 28px;
    fill: #222;
  }

  /* AI ì¶”ì²œ ì‚¬ë¡€ UI */
  #aiSuggestion {
    margin-top: 20px;
    text-align: left;
    background:#222; 
    padding: 10px; 
    border-radius: 10px; 
    min-height: 120px; 
    color:#eee; 
    overflow-y: auto; 
    max-height: 200px;
    font-size: 0.95rem;
  }
  #aiSuggestion p {
    margin-bottom: 8px;
    cursor: pointer;
  }
  #aiSuggestion p:hover {
    background: #444;
    border-radius: 6px;
  }

  /* í•˜ë‹¨ ë²„íŠ¼ë“¤ */
  .btn-row {
    margin-top: 20px;
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn-row button {
    flex: 1 1 140px;
    padding: 14px 0;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 14px;
    border: none;
    cursor: pointer;
    color: #222;
    background: linear-gradient(135deg, #fff176, #fbc02d);
    box-shadow:
      0 6px 20px rgba(251, 192, 45, 0.6),
      inset 0 -4px 6px rgba(255, 255, 255, 0.6);
    transition:
      background 0.3s ease,
      box-shadow 0.3s ease,
      transform 0.2s ease;
    user-select: none;
    letter-spacing: 0.06em;
  }
  .btn-row button:hover {
    background: linear-gradient(135deg, #fffde7, #fdd835);
    box-shadow:
      0 10px 30px rgba(251, 192, 45, 0.85),
      inset 0 -6px 8px rgba(255, 255, 255, 0.8);
    transform: scale(1.04);
  }
  .btn-row button:active {
    transform: scale(0.98);
    box-shadow:
      0 4px 15px rgba(251, 192, 45, 0.5),
      inset 0 -3px 5px rgba(255, 255, 255, 0.5);
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 900px) {
    .container {
      flex-direction: column;
      padding: 20px;
    }
    .left-panel, .right-panel {
      width: 100%;
      border-radius: 20px;
    }
    .btn-row button {
      flex: 1 1 100%;
    }
  }
</style>
</head>
<body>

  <div class="container">

    <section class="left-panel" aria-label="ì„¤êµ ê¸°ë³¸ ì •ë³´ ì…ë ¥">
      <div>
        <label for="bibleText">1. ì£¼ì œ ì„±ê²½ ë§ì”€</label>
        <input type="text" id="bibleText" placeholder="ì„±ê²½ ë§ì”€ ì…ë ¥..." />
      </div>
      <div>
        <label for="sermonTitle">2. ë§ì”€ ì œëª©</label>
        <input type="text" id="sermonTitle" placeholder="ì„¤êµ ì œëª© ì…ë ¥..." />
      </div>
      <div>
        <label for="audienceSelect">3. ì„¤êµ ëŒ€ìƒ ì„ íƒ</label>
        <select id="audienceSelect" aria-describedby="audienceHelp">
          <option value="" disabled selected>ì„¤êµ ëŒ€ìƒ ì„ íƒ</option>
          <option value="ì£¼ì¼ëŒ€ì˜ˆë°°">ì£¼ì¼ëŒ€ì˜ˆë°°</option>
          <option value="ìˆ˜ìš”ì˜ˆë°°">ìˆ˜ìš”ì˜ˆë°°</option>
          <option value="ì²­ë…„ëŒ€í•™ë¶€">ì²­ë…„ëŒ€í•™ë¶€</option>
          <option value="ìœ ì•„ì´ˆë“±ë¶€">ìœ ì•„ ì´ˆë“±ë¶€</option>
          <option value="ì¤‘ê³ í•™ìƒë¶€">ì¤‘ê³  í•™ìƒë¶€</option>
          <option value="ì² ì•¼ì˜ˆë°°">ì² ì•¼ì˜ˆë°°</option>
          <option value="ìƒˆë²½ê¸°ë„íšŒ">ìƒˆë²½ê¸°ë„íšŒ</option>
          <option value="ê²°í˜¼ì‹">ê²°í˜¼ì‹</option>
          <option value="ì¥ë¡€ì‹">ì¥ë¡€ì‹</option>
        </select>
      </div>
      <div>
        <label for="sermonTime">4. ì„¤êµ ì‹œê°„ ì„ íƒ</label>
        <select id="sermonTime" aria-describedby="timeHelp">
          <option value="" disabled selected>ì„¤êµ ì‹œê°„ ì„ íƒ</option>
          <option value="15ë¶„">15ë¶„</option>
          <option value="20ë¶„">20ë¶„</option>
          <option value="30ë¶„">30ë¶„</option>
          <option value="40ë¶„">40ë¶„</option>
        </select>
      </div>
      <div>
        <label for="exampleSearch">5. ì£¼ì œ ê´€ë ¨ ì‚¬ë¡€, ì˜ˆí™” ì°¾ê¸°</label>
        <input type="text" id="exampleSearch" placeholder="ì˜ˆí™” í‚¤ì›Œë“œ ì…ë ¥..." />
      </div>
    </section>

    <section class="right-panel" aria-label="ì„¤êµ ë‚´ìš© ì‘ì„±">
      <label for="sermonContent">ì„¤êµ ë‚´ìš© ì‘ì„±ë€</label>
      <textarea id="sermonContent" rows="18" placeholder="ì„¤êµ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
<!-- AI ê¸°ëŠ¥ ë²„íŠ¼ë“¤ (ì„¤êµ ì‘ì„±ë€ ì•„ë˜ìª½ì— ì¶”ê°€) -->
<div class="btn-row">
  <button onclick="refineSermon()">ğŸª„ ë¬¸ì¥ ë‹¤ë“¬ê¸°</button>
  <button onclick="rewriteSermon()">ğŸ¯ ëŒ€ìƒ ë§ì¶¤í™”</button>
</div>

      <!-- ìŒì„±ì¸ì‹ ë§ˆì´í¬ ë²„íŠ¼ -->
      <button id="micBtn" aria-label="ìŒì„± ì¸ì‹ ì‹œì‘/ì¤‘ì§€" title="ìŒì„±ìœ¼ë¡œ ì„¤êµ ë‚´ìš© ì…ë ¥" >
        ğŸ¤
      </button>

      <!-- AI ì¶”ì²œ ì‚¬ë¡€ UI -->
      <div id="aiSuggestion">
        ì—¬ê¸°ì— AI ì¶”ì²œ ì‚¬ë¡€ê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </div>

      <!-- í•˜ë‹¨ ë²„íŠ¼ -->
      <div class="btn-row">
        <button id="btnEdit">ìˆ˜ì •í•˜ê¸°</button>
        <button id="btnSave">ì €ì¥í•˜ê¸°</button>
        <button id="btnPrint">ì¸ì‡„</button>
        <button id="btnSendTablet">í…Œë¸”ë¦¿/í”¼ì‹œë¡œ ë³´ë‚´ê¸°</button>
        <button id="btnCreateBulletin">ì£¼ë³´ ë§Œë“¤ê¸°</button>
      </div>
    </section>

  </div>

  <script>
    // ìŒì„± ì¸ì‹ ê¸°ë³¸ ì„¤ì •
    const micBtn = document.getElementById('micBtn');
    const sermonContent = document.getElementById('sermonContent');
    const aiSuggestion = document.getElementById('aiSuggestion');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í¬ë¡¬ ìµœì‹ ë²„ì „ì„ ì‚¬ìš©í•˜ì„¸ìš”.");
      micBtn.disabled = true;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'ko-KR';
    recognition.interimResults = true;
    recognition.continuous = true;

    let isListening = false;

    micBtn.addEventListener('click', () => {
      if (isListening) {
        recognition.stop();
        micBtn.classList.remove('active');
        isListening = false;
      } else {
        recognition.start();
        micBtn.classList.add('active');
        isListening = true;
      }
    });

    recognition.onresult = (event) => {
      let interimTranscript = '';
      let finalTranscript = sermonContent.value;

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += transcript + ' ';
        } else {
          interimTranscript += transcript;
        }
      }

      sermonContent.value = finalTranscript + interimTranscript;
      sermonContent.scrollTop = sermonContent.scrollHeight;
    };

    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
    };

    recognition.onend = () => {
      if (isListening) {
        recognition.start(); // ëŠê²¨ë„ ë‹¤ì‹œ ì‹œì‘ (ì—°ì† ì¸ì‹)
      }
    };

    // AI ì‚¬ë¡€ ì¶”ì²œ í•¨ìˆ˜
    async function fetchExamples(keyword) {
      if (!keyword.trim()) {
        aiSuggestion.textContent = "ì£¼ì œë‚˜ í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        return;
      }

      aiSuggestion.textContent = "ì‚¬ë¡€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

      try {
        const response = await fetch('/api/generateExamples', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: `â€œ${keyword}â€ ì£¼ì œì™€ ê´€ë ¨ëœ ì„¤êµ ì‚¬ë¡€ë‚˜ ì˜ˆí™”ë¥¼ 3ê°€ì§€ ê°„ëµíˆ ì„¤ëª…í•´ì¤˜.` }),
        });

        const data = await response.json();
        if (data.error) throw new Error(data.error);

        aiSuggestion.innerHTML = "";
        const rawExamples = data.examples || data;

        const examples = rawExamples.split(/\n+/).filter(line => line.trim() !== "");

        examples.forEach((ex) => {
          const p = document.createElement('p');
          p.textContent = ex;
          p.title = "í´ë¦­í•˜ë©´ ì„¤êµ ë‚´ìš©ì— ë³µì‚¬";
          p.style.cursor = "pointer";
          p.onclick = () => {
            sermonContent.value += (sermonContent.value ? '\n\n' : '') + ex;
            sermonContent.focus();
          };
          aiSuggestion.appendChild(p);
        });

      } catch (err) {
        aiSuggestion.textContent = "ì‚¬ë¡€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + err.message;
      }
    }

    // ìŒì„± ì¸ì‹ ê²°ê³¼ë¥¼ í‚¤ì›Œë“œë¡œ ìë™ AI í˜¸ì¶œ (ì˜ˆ: 3ì´ˆ ì…ë ¥ ë©ˆì¶¤ í›„ í˜¸ì¶œ)
    let typingTimer;
    const doneTypingInterval = 3000; // 3ì´ˆ

    sermonContent.addEventListener('input', () => {
      clearTimeout(typingTimer);
      typingTimer = setTimeout(() => {
        const keywords = sermonContent.value.trim().split(/\s+/).slice(-3).join(' ');
        fetchExamples(keywords);
      }, doneTypingInterval);
    });

    sermonContent.addEventListener('keydown', () => {
      clearTimeout(typingTimer);
    });

    // í•˜ë‹¨ ë²„íŠ¼ ì´ë²¤íŠ¸ (ì˜ˆì‹œ)
    document.getElementById('btnEdit').onclick = () => alert('ìˆ˜ì • ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    document.getElementById('btnSave').onclick = () => alert('ì €ì¥ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    document.getElementById('btnPrint').onclick = () => window.print();
    document.getElementById('btnSendTablet').onclick = () => alert('í…Œë¸”ë¦¿/í”¼ì‹œ ì „ì†¡ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    document.getElementById('btnCreateBulletin').onclick = () => alert('ì£¼ë³´ ë§Œë“¤ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
  </script>
    // AI API URL
  const AI_API_URL = "https://us-central1-sermonnote-live.cloudfunctions.net/ai";

  async function refineSermon() {
    const content = sermonContent.value.trim();
    if (!content) {
      alert("ì„¤êµ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const prompt = `ë‹¤ìŒ ì„¤êµë¬¸ì„ ë” ë¶€ë“œëŸ½ê³ , ì„¤ë“ë ¥ ìˆëŠ” ë¬¸ì²´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë“¬ì–´ì¤˜:\n\n${content}`;
    sermonContent.value = "ğŸª„ AIê°€ ë¬¸ì¥ì„ ë‹¤ë“¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
    const result = await callAI(prompt);
    sermonContent.value = result || "AI ì‘ë‹µì´ ì—†ì—ˆìŠµë‹ˆë‹¤.";
  }

  async function rewriteSermon() {
    const content = sermonContent.value.trim();
    const target = document.getElementById("audienceSelect").value;
    if (!content || !target) {
      alert("ì„¤êµë¬¸ê³¼ ì„¤êµ ëŒ€ìƒì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const prompt = `ì•„ë˜ ì„¤êµë¬¸ì„ "${target}"ì— ë§ëŠ” ë§íˆ¬ì™€ ì˜ˆí™” ìŠ¤íƒ€ì¼ë¡œ ë°”ê¿”ì¤˜:\n\n${content}`;
    sermonContent.value = "ğŸ¯ AIê°€ ëŒ€ìƒ ë§ì¶¤ ë¦¬ë¼ì´íŒ… ì¤‘ì…ë‹ˆë‹¤...";
    const result = await callAI(prompt);
    sermonContent.value = result || "AI ì‘ë‹µì´ ì—†ì—ˆìŠµë‹ˆë‹¤.";
  }

  async function callAI(prompt) {
    try {
      const response = await fetch(AI_API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt }),
      });

      const data = await response.json();
      if (data.error) throw new Error(data.error);
      return data.result || data.choices?.[0]?.message?.content;
    } catch (err) {
      alert("AI í˜¸ì¶œ ì‹¤íŒ¨: " + err.message);
      return "";
    }
  }
  <input id="rangeInput" placeholder="ì˜ˆ: ë¡œë§ˆì„œ 8:28~30" />
<button onclick="searchRange()">ğŸ“– êµ¬ì ˆ ê²€ìƒ‰</button>
<pre id="bibleResult"></pre>
<button onclick="insertToSermon()">ğŸ“ ì„¤êµë¬¸ì— ì‚½ì…</button>

<textarea id="sermonText" rows="15" style="width:100%;"></textarea>

</script>
</body>
</html>