<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í€µë©”ëª¨ ì„¤êµì‘ì„±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB1YVJr-aPDADp-SgYtA9X2XagYoTTJn4M",
      authDomain: "sermonnote-live.firebaseapp.com",
      projectId: "sermonnote-live",
      storageBucket: "sermonnote-live.appspot.com",
      messagingSenderId: "924542148810",
      appId: "1:924542148810:web:b9f0f6848eb333f24b1433"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <style>
    html, body { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; }
    body {
      font-family: 'Nanum Gothic', sans-serif;
      background: linear-gradient(135deg, #0a0f1a, #16213e);
      color: #f0f0f0;
      display: flex;
    }
    .left-panel {
      width: 360px;
      background: #0d1b2a;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .right-panel {
      flex: 1;
      padding: 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    textarea, input[type="text"] {
      width: 100%;
      padding: 14px;
      margin-bottom: 14px;
      border: none;
      border-radius: 4px;
      font-size: 18px;
      background: #1e2a3a;
      color: #f0f0f0;
    }
    button {
      margin-right: 10px;
      margin-bottom: 10px;
      padding: 10px 18px;
      background: #0077b6;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
    }
    .memo-item {
      background: #1e2a3a;
      padding: 6px 10px;
      border-radius: 4px;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .memo-text { flex: 1; cursor: pointer; }
    .delete-btn {
      background: transparent;
      color: #f55;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    #statusMsg {
  color: lightgreen;
  margin-top: auto;
  font-size: 16px;
  padding-top: 10px;
  border-top: 1px solid #344b63;
}
  </style>
</head>
<body>
  <div class="left-panel">
    <h3>ğŸ“ í€µë©”ëª¨</h3>
    <div id="memoList"></div>
    <hr style="margin: 15px 0; border-color: #344b63">
    <button onclick="generateSermon()">ğŸ§  ì„¤êµë¬¸ ì‘ì„±</button>
    <button onclick="recommendHymn()">ğŸµ ì°¬ì†¡ê°€ ì¶”ì²œ</button>
    <input type="text" id="bibleRange" placeholder="ì˜ˆ: ìš”í•œë³µìŒ 3ì¥ 16~18ì ˆ">
    <button onclick="fetchBibleRange()">ğŸ“˜ ì„±ê²½ ë²”ìœ„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>
  <div class="right-panel">
    <h2>ğŸ“˜ ì„¤êµë¬¸ ì‘ì„±</h2>
    <input type="text" id="sermonTitle" placeholder="ì„¤êµ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
    <input type="text" id="sermonDate" placeholder="ì„¤êµ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2025-07-10)">
    <textarea id="sermonText" rows="30" placeholder="ì—¬ê¸°ì— ì„¤êµë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
    <div>
      <button onclick="saveToFirebase()">Firebase ì €ì¥</button>
      <button onclick="grammarCorrect()">ë¬¸ë²• êµì •</button>
      <button onclick="summarizeSermon()">ìš”ì•½/ì •ë¦¬</button>
      <button onclick="printSermon()">ì¸ì‡„</button>
      <button onclick="saveAsPDF()">PDF ì €ì¥</button>
    </div>
    <div id="statusMsg"></div>
  </div>
  <script>
    const memoListDiv = document.getElementById("memoList");
    const sermonText = document.getElementById("sermonText");
    const sermonTitle = document.getElementById("sermonTitle");
    const statusMsg = document.getElementById("statusMsg");

    function renderMemos() {
      memoListDiv.innerHTML = "";
      const memos = JSON.parse(localStorage.getItem("quickMemos")) || [];
      memos.slice(0, 5).forEach((memo, index) => {
        const div = document.createElement("div");
        div.className = "memo-item";

        const textSpan = document.createElement("span");
        textSpan.className = "memo-text";
        textSpan.textContent = memo;
        textSpan.onclick = () => {
          sermonTitle.value = memo;
          sermonText.value = `ğŸ“ í€µë©”ëª¨ì—ì„œ ê°€ì ¸ì˜¨ ì„¤êµ: ${memo}

`; // ì™„ì „ ìƒˆë¡œ ì‹œì‘
          statusMsg.textContent = "â³ ì„¤êµë¬¸ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...";
          generateSermon();
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.innerHTML = "âŒ";
        deleteBtn.onclick = () => {
          memos.splice(index, 1);
          localStorage.setItem("quickMemos", JSON.stringify(memos));
          renderMemos();
        };

        div.appendChild(textSpan);
        div.appendChild(deleteBtn);
        memoListDiv.appendChild(div);
      });
    }

    function generateSermon() {
  const topic = sermonTitle.value.trim();
  if (!topic) return alert("ë¨¼ì € ì„¤êµ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
  statusMsg.textContent = "â³ ì„¤êµë¬¸ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...";

  const prompt = `${topic}ì— ëŒ€í•´ ê°•í•´ì‹ ì„¤êµ ìŠ¤íƒ€ì¼ë¡œ 2ë‹¨ê³„ë¡œ ë‚˜ëˆ  ì‘ì„±í•´ì¤˜.
1ë‹¨ê³„: ê°œìš”, ë³¸ë¬¸ í•´ì„
2ë‹¨ê³„: ì ìš©, ë¬µìƒ, ì¶”ì²œ ì°¬ì†¡ê°€ ì œì•ˆ`;

  fetch("https://us-central1-sermonnote-live.cloudfunctions.net/ai", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt, max_tokens: 2000, temperature: 0.5 })
  })
    .then(res => res.json())
    .then(data1 => {
      sermonText.value += `

${data1.result || 'âš ï¸ 1ë‹¨ê³„ ì„¤êµ ìƒì„± ì‹¤íŒ¨'}`;
      return fetch("https://us-central1-sermonnote-live.cloudfunctions.net/ai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: `${topic} ì„¤êµì˜ í›„ë°˜ë¶€ë¥¼ ì‘ì„±í•´ì¤˜.
ë‚´ìš©: ì ìš© â†’ ë¬µìƒ â†’ ì¶”ì²œ ì°¬ì†¡ê°€ í¬í•¨`,
          max_tokens: 2000,
          temperature: 0.5
        })
      });
    })
    .then(res => res.json())
    .then(data2 => {
      sermonText.value += `

${data2.result || 'âš ï¸ 2ë‹¨ê³„ ì„¤êµ ìƒì„± ì‹¤íŒ¨'}`;
      statusMsg.textContent = "âœ… ì„¤êµë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.";
    })
    .catch(err => {
      alert("AI ì˜¤ë¥˜: " + err);
      statusMsg.textContent = "âŒ ì„¤êµë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
    });
}

window.onload = () => {
  renderMemos();
};
 function grammarCorrect() {
  const text = sermonText.value.trim();
  if (!text) return alert("ì„¤êµë¬¸ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤");

  statusMsg.textContent = "âœ ë¬¸ë²• êµì • ì¤‘ì…ë‹ˆë‹¤...";
  fetch("https://us-central1-sermonnote-live.cloudfunctions.net/ai", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      prompt: `ë‹¤ìŒ í•œêµ­ì–´ ì„¤êµë¬¸ ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê³  ë¬¸ë²•ì ìœ¼ë¡œ ê³ ì³ì¤˜:\n\n${text}`,
      max_tokens: 2000,
      temperature: 0.3
    })
  })
    .then(res => res.json())
    .then(data => {
      sermonText.value = data.result || text;
      statusMsg.textContent = "âœ… ë¬¸ë²• êµì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
    })
    .catch(err => {
      alert("ë¬¸ë²• êµì • ì˜¤ë¥˜: " + err);
      statusMsg.textContent = "âŒ ë¬¸ë²• êµì • ì‹¤íŒ¨";
    });
}
 function fetchBibleRange() {
  const rangeInput = document.getElementById("bibleRange").value.trim();
  const match = rangeInput.match(/(.+?)\s*(\d+)ì¥\s*(\d+)(?:[~\-](\d+))?ì ˆ?/);
  if (!match) {
    alert("ì„±ê²½ ë²”ìœ„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: ìš”í•œë³µìŒ 3ì¥ 16ì ˆ)");
    return;
  }
  const [_, bookKor, chapter, verseStart, verseEnd] = match;
  const bookMap = {
    "ì°½ì„¸ê¸°": "Genesis", "ì¶œì• êµ½ê¸°": "Exodus", "ë ˆìœ„ê¸°": "Leviticus", "ë¯¼ìˆ˜ê¸°": "Numbers",
    "ì‹ ëª…ê¸°": "Deuteronomy", "ë§ˆíƒœë³µìŒ": "Matthew", "ë§ˆê°€ë³µìŒ": "Mark",
    "ëˆ„ê°€ë³µìŒ": "Luke", "ìš”í•œë³µìŒ": "John"
  };
 // ì˜ì–´ â†’ í•œê¸€ ì±… ì´ë¦„ ë§¤í•‘
const bookMap = {
  "Genesis": "ì°½ì„¸ê¸°",
  "Exodus": "ì¶œì• êµ½ê¸°",
  "Leviticus": "ë ˆìœ„ê¸°",
  "Numbers": "ë¯¼ìˆ˜ê¸°",
  "Deuteronomy": "ì‹ ëª…ê¸°",
  "Joshua": "ì—¬í˜¸ìˆ˜ì•„",
  "Judges": "ì‚¬ì‚¬ê¸°",
  "Ruth": "ë£»ê¸°",
  "1 Samuel": "ì‚¬ë¬´ì—˜ìƒ",
  "2 Samuel": "ì‚¬ë¬´ì—˜í•˜",
  "1 Kings": "ì—´ì™•ê¸°ìƒ",
  "2 Kings": "ì—´ì™•ê¸°í•˜",
  "1 Chronicles": "ì—­ëŒ€ìƒ",
  "2 Chronicles": "ì—­ëŒ€í•˜",
  "Ezra": "ì—ìŠ¤ë¼",
  "Nehemiah": "ëŠí—¤ë¯¸ì•¼",
  "Esther": "ì—ìŠ¤ë”",
  "Job": "ìš¥ê¸°",
  "Psalms": "ì‹œí¸",
  "Proverbs": "ì ì–¸",
  "Ecclesiastes": "ì „ë„ì„œ",
  "Song of Songs": "ì•„ê°€",
  "Isaiah": "ì´ì‚¬ì•¼",
  "Jeremiah": "ì˜ˆë ˆë¯¸ì•¼",
  "Lamentations": "ì˜ˆë ˆë¯¸ì•¼ì• ê°€",
  "Ezekiel": "ì—ìŠ¤ê²”",
  "Daniel": "ë‹¤ë‹ˆì—˜",
  "Hosea": "í˜¸ì„¸ì•„",
  "Joel": "ìš”ì—˜",
  "Amos": "ì•„ëª¨ìŠ¤",
  "Obadiah": "ì˜¤ë°”ëŒœ",
  "Jonah": "ìš”ë‚˜",
  "Micah": "ë¯¸ê°€",
  "Nahum": "ë‚˜í›”",
  "Habakkuk": "í•˜ë°•êµ­",
  "Zephaniah": "ìŠ¤ë°”ëƒ",
  "Haggai": "í•™ê°œ",
  "Zechariah": "ìŠ¤ê°€ë´",
  "Malachi": "ë§ë¼ê¸°",
  "Matthew": "ë§ˆíƒœë³µìŒ",
  "Mark": "ë§ˆê°€ë³µìŒ",
  "Luke": "ëˆ„ê°€ë³µìŒ",
  "John": "ìš”í•œë³µìŒ",
  "Acts": "ì‚¬ë„í–‰ì „",
  "Romans": "ë¡œë§ˆì„œ",
  "1 Corinthians": "ê³ ë¦°ë„ì „ì„œ",
  "2 Corinthians": "ê³ ë¦°ë„í›„ì„œ",
  "Galatians": "ê°ˆë¼ë””ì•„ì„œ",
  "Ephesians": "ì—ë² ì†Œì„œ",
  "Philippians": "ë¹Œë¦½ë³´ì„œ",
  "Colossians": "ê³¨ë¡œìƒˆì„œ",
  "1 Thessalonians": "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",
  "2 Thessalonians": "ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ",
  "1 Timothy": "ë””ëª¨ë°ì „ì„œ",
  "2 Timothy": "ë””ëª¨ë°í›„ì„œ",
  "Titus": "ë””ë„ì„œ",
  "Philemon": "ë¹Œë ˆëª¬ì„œ",
  "Hebrews": "íˆë¸Œë¦¬ì„œ",
  "James": "ì•¼ê³ ë³´ì„œ",
  "1 Peter": "ë² ë“œë¡œì „ì„œ",
  "2 Peter": "ë² ë“œë¡œí›„ì„œ",
  "1 John": "ìš”í•œì¼ì„œ",
  "2 John": "ìš”í•œì´ì„œ",
  "3 John": "ìš”í•œì‚¼ì„œ",
  "Jude": "ìœ ë‹¤ì„œ",
  "Revelation": "ìš”í•œê³„ì‹œë¡"
};

let krvJson = {};

fetch('/krv.json')
  .then(res => res.json())
  .then(data => krvJson = data)
  .catch(err => console.error('KRV ë¡œë”© ì˜¤ë¥˜:', err));

function fetchVerse() {
  const input = document.getElementById('verseInput').value.trim();
  const [engBook, chapterVerse] = input.split(/ (?=\d)/); // "Genesis 1:1"
  const korBook = bookMap[engBook];

  if (!korBook) {
    document.getElementById('verseResult').textContent = 'ì„±ê²½ ì±…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }

  const key = `${korBook} ${chapterVerse}`;
  const verse = krvJson[key];
  document.getElementById('verseResult').textContent = verse || 'í•´ë‹¹ êµ¬ì ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
}

  const bookEng = bookMap[bookKor.trim()] || bookKor.trim();
  const reference = verseEnd ? `${chapter}:${verseStart}-${verseEnd}` : `${chapter}:${verseStart}`;
  const url = `https://bible-api.com/${bookEng}+${reference}`;

  statusMsg.textContent = "ğŸ“˜ ì„±ê²½ ë³¸ë¬¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
  fetch(url)
    .then(res => res.json())
    .then(data => {
      sermonText.value += `\n\nğŸ“˜ ì„±ê²½ ë³¸ë¬¸: ${data.text}`;
      statusMsg.textContent = "âœ… ì„±ê²½ ë³¸ë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.";
    })
    .catch(err => {
      alert("ì„±ê²½ API ì˜¤ë¥˜: " + err);
      statusMsg.textContent = "âŒ ë³¸ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
    });
    <input id="rangeInput" placeholder="ì˜ˆ: ë¡œë§ˆì„œ 8:28~30" />
<button onclick="searchRange()">ğŸ“– êµ¬ì ˆ ê²€ìƒ‰</button>
<pre id="bibleResult"></pre>
<button onclick="insertToSermon()">ğŸ“ ì„¤êµë¬¸ì— ì‚½ì…</button>

<textarea id="sermonText" rows="15" style="width:100%;"></textarea>

}
</script>
 </body>
</html>
