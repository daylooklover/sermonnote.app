<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì„¤êµ ì‘ì„± í™”ë©´ - AI ì¶”ì²œ + ìŒì„±ì¸ì‹ + OpenAI ì—°ë™</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
  @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');
  * { box-sizing: border-box; }
  body {
    margin:0; padding:0;
    font-family:'Nanum Gothic', sans-serif;
    background: linear-gradient(135deg, #1c1c2b, #28313b);
    color:#f0e6d2;
    height: 100vh;
    display: flex;
  }
  .left-panel {
    width: 320px;
    background: rgba(30,30,42,0.85);
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 0 30px #ffc10744 inset;
    display: flex;
    flex-direction: column;
    gap: 15px;
    overflow-y: auto;
  }
  .left-panel label {
    font-weight: 700;
    margin-bottom: 6px;
    color: #ffe57f;
    text-shadow: 0 0 6px #ffd54f;
  }
  .left-panel input[type="text"], .left-panel select {
    width: 100%;
    padding: 10px;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  .left-panel input[type="text"]:focus, .left-panel select:focus {
    box-shadow: 0 0 10px #ffd54f;
  }
  .quickmemo-list {
    background: #222;
    border-radius: 12px;
    padding: 10px;
    max-height: 140px;
    overflow-y: auto;
    color: #eee;
    user-select: none;
  }
  .quickmemo-item {
    padding: 8px;
    border-radius: 8px;
    margin-bottom: 6px;
    background: #333;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  .quickmemo-item:hover {
    background: #444;
  }
  .quickmemo-item.selected {
    background-color: #ffeb3b;
    color: #222;
    font-weight: 700;
    border-left: 6px solid #fbc02d;
  }
  .button-group {
    display: flex;
    gap: 8px;
    margin-top: 6px;
    flex-wrap: wrap;
  }
  button {
    cursor: pointer;
    user-select: none;
    border: none;
    border-radius: 10px;
    padding: 6px 12px;
    font-weight: 600;
    font-size: 0.85rem;
    transition: background-color 0.3s ease;
    background: linear-gradient(90deg, #ffeb3b, #fdd835);
    color: #222;
    box-shadow: 0 4px 10px rgba(253,216,53,0.7);
  }
  button:hover {
    background: linear-gradient(90deg, #fdd835, #ffeb3b);
    box-shadow: 0 6px 15px rgba(253,216,53,0.9);
  }
  button:active {
    transform: scale(0.95);
  }
  .right-panel {
    flex: 1;
    background: rgba(30,30,42,0.85);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 0 50px #ffc10744 inset;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .right-panel label {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #ffe57f;
    text-shadow: 0 0 8px #ffd54f;
  }
  .right-panel textarea {
    flex: 1;
    padding: 20px;
    font-size: 1.1rem;
    border-radius: 16px;
    border: none;
    resize: none;
    background: #1e1e2a;
    color: #eee;
    outline: none;
    box-shadow: inset 0 0 15px #ffc10744;
    transition: box-shadow 0.3s ease;
  }
  .right-panel textarea:focus {
    box-shadow: inset 0 0 25px #ffd54faa;
  }
  #micBtn {
    position: absolute;
    top: 30px;
    right: 30px;
    background-color: #ffeb3b;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(251, 192, 45, 0.8);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    z-index: 10;
    font-size: 1.8rem;
  }
  #micBtn.active {
    background-color: #f44336;
    box-shadow: 0 8px 30px rgba(244, 67, 54, 0.9);
    animation: pulse 1.5s infinite;
    color: white;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
    70% { box-shadow: 0 0 0 12px rgba(244, 67, 54, 0); }
    100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
  }
  #aiSuggestion {
    margin-top: 20px;
    text-align: left;
    background:#222; 
    padding: 12px; 
    border-radius: 10px; 
    min-height: 120px; 
    color:#eee; 
    overflow-y: auto; 
    max-height: 200px;
    font-size: 0.95rem;
    user-select: text;
    white-space: pre-wrap;
  }
  #aiSuggestion p {
    margin-bottom: 8px;
    cursor: pointer;
  }
  #aiSuggestion p:hover {
    background: #444;
    border-radius: 6px;
  }
  .bottom-btns {
    position: fixed;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 14px;
    background: rgba(30,30,42,0.9);
    padding: 12px 20px;
    border-radius: 30px;
    box-shadow: 0 0 25px #ffc107cc;
    z-index: 1000;
  }
  .bottom-btns button {
    background: linear-gradient(90deg, #ffeb3b, #fdd835);
    color: #222;
    border: none;
    border-radius: 14px;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(253,216,53,0.7);
    transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
    user-select: none;
  }
  .bottom-btns button:hover {
    background: linear-gradient(90deg, #fdd835, #ffeb3b);
    box-shadow: 0 10px 30px rgba(253,216,53,0.85);
    transform: scale(1.05);
  }
  .bottom-btns button:active {
    transform: scale(0.98);
    box-shadow: 0 4px 15px rgba(253,216,53,0.5);
  }
  @media (max-width: 700px) {
    .bottom-btns {
      flex-direction: column;
      padding: 10px;
      gap: 10px;
    }
    .bottom-btns button {
      width: 100%;
      font-size: 1.1rem;
    }
  }
</style>
</head>
<body>

<div style="display:flex; height:100vh;">
  <div class="left-panel" aria-label="í€µë©”ëª¨ ë° ê²€ìƒ‰">
    <div>
      <label for="quickmemoSearch">í€µë©”ëª¨ ì°¾ê¸°</label>
      <input type="text" id="quickmemoSearch" placeholder="í€µë©”ëª¨ ì œëª© ê²€ìƒ‰..." />
      <div class="quickmemo-list" id="quickmemoList"></div>
      <div class="button-group">
        <button id="editQuickmemoBtn">ìˆ˜ì •í•˜ê¸°</button>
        <button id="saveQuickmemoBtn">ì €ì¥í•˜ê¸°</button>
        <button id="addQuickmemoBtn">ì¶”ê°€í•˜ê¸°</button>
        <button id="deleteQuickmemoBtn">ì‚­ì œí•˜ê¸°</button>
      </div>
    </div>
  </div>
  <div class="right-panel" aria-label="ì„¤êµ ì‘ì„±">
    <label for="sermonContent">ì„¤êµ ë‚´ìš© ì‘ì„±ë€</label>
    <textarea id="sermonContent" rows="18" placeholder="ì„¤êµ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
    <button id="micBtn" aria-label="ìŒì„± ì¸ì‹ ì‹œì‘/ì¤‘ì§€" title="ìŒì„±ìœ¼ë¡œ ì„¤êµ ë‚´ìš© ì…ë ¥">ğŸ¤</button>
    <div id="aiSuggestion">ì—¬ê¸°ì— AI ì¶”ì²œ ì‚¬ë¡€ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>
</div>

<div class="bottom-btns" aria-label="ì„¤êµ ì‘ì—… ë²„íŠ¼">
  <button id="btnEditBottom">ìˆ˜ì •í•˜ê¸°</button>
  <button id="btnSaveBottom">ì €ì¥í•˜ê¸°</button>
  <button id="btnPrintBottom">ì¸ì‡„</button>
  <button id="btnSendTabletBottom">í…Œë¸”ë¦¿/í”¼ì‹œë¡œ ë³´ë‚´ê¸°</button>
  <button id="btnCreateBulletinBottom">ì£¼ë³´ ë§Œë“¤ê¸°</button>
</div>

<script>
  const sermonContent = document.getElementById('sermonContent');
  const aiSuggestion = document.getElementById('aiSuggestion');
  const micBtn = document.getElementById('micBtn');
  const quickmemoList = document.getElementById('quickmemoList');
  const quickmemoSearch = document.getElementById('quickmemoSearch');
  const editQuickmemoBtn = document.getElementById('editQuickmemoBtn');
  const saveQuickmemoBtn = document.getElementById('saveQuickmemoBtn');
  const addQuickmemoBtn = document.getElementById('addQuickmemoBtn');
  const deleteQuickmemoBtn = document.getElementById('deleteQuickmemoBtn');

  // localStorageì—ì„œ í€µë©”ëª¨ ë¶ˆëŸ¬ì˜¤ê¸°
  let quickmemos = JSON.parse(localStorage.getItem('quickmemos') || '[]');
  let selectedQuickmemoIndex = null;

  // í€µë©”ëª¨ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
  function renderQuickmemoList() {
    quickmemoList.innerHTML = "";
    quickmemos.forEach((item, idx) => {
      const div = document.createElement("div");
      div.textContent = item;
      div.className = "quickmemo-item";
      div.dataset.idx = idx;
      if(idx === selectedQuickmemoIndex) div.style.backgroundColor = "#555";
      quickmemoList.appendChild(div);
    });
  }

  renderQuickmemoList();

  // í€µë©”ëª¨ ì„ íƒ ì´ë²¤íŠ¸
  quickmemoList.addEventListener('click', e => {
    if(e.target && e.target.dataset.idx !== undefined) {
      selectedQuickmemoIndex = Number(e.target.dataset.idx);
      renderQuickmemoList();
      sermonContent.value = quickmemos[selectedQuickmemoIndex];
      updateAISuggestion(sermonContent.value);
    }
  });

  // í€µë©”ëª¨ ê²€ìƒ‰
  quickmemoSearch.addEventListener('input', () => {
    const keyword = quickmemoSearch.value.trim();
    if(keyword.length > 0) {
      const filtered = quickmemos.filter(qm => qm.includes(keyword));
      quickmemoList.innerHTML = "";
      filtered.forEach((item, idx) => {
        const div = document.createElement("div");
        div.textContent = item;
        div.className = "quickmemo-item";
        div.dataset.idx = quickmemos.indexOf(item);
        quickmemoList.appendChild(div);
      });
      selectedQuickmemoIndex = null;
      sermonContent.value = "";
      updateAISuggestion("");
    } else {
      selectedQuickmemoIndex = null;
      sermonContent.value = "";
      renderQuickmemoList();
      updateAISuggestion("");
    }
  });

  // í€µë©”ëª¨ ìˆ˜ì • ë²„íŠ¼
  editQuickmemoBtn.onclick = () => {
    if(selectedQuickmemoIndex === null) {
      alert("ìˆ˜ì •í•  í€µë©”ëª¨ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }
    sermonContent.value = quickmemos[selectedQuickmemoIndex];
    updateAISuggestion(sermonContent.value);
  };

  // í€µë©”ëª¨ ì €ì¥ ë²„íŠ¼
  saveQuickmemoBtn.onclick = () => {
    if(selectedQuickmemoIndex === null) {
      alert("ì €ì¥í•  í€µë©”ëª¨ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }
    if(sermonContent.value.trim() === "") {
      alert("ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
      return;
    }
    quickmemos[selectedQuickmemoIndex] = sermonContent.value.trim();
    localStorage.setItem('quickmemos', JSON.stringify(quickmemos));
    renderQuickmemoList();
    alert("í€µë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
  };

  // í€µë©”ëª¨ ì¶”ê°€ ë²„íŠ¼
  addQuickmemoBtn.onclick = () => {
    const newMemo = prompt("ìƒˆ í€µë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:");
    if (newMemo && newMemo.trim()) {
      quickmemos.push(newMemo.trim());
      localStorage.setItem('quickmemos', JSON.stringify(quickmemos));
      renderQuickmemoList();
      alert("í€µë©”ëª¨ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
  };

  // í€µë©”ëª¨ ì‚­ì œ ë²„íŠ¼
  deleteQuickmemoBtn.onclick = () => {
    if (selectedQuickmemoIndex === null) {
      alert("ì‚­ì œí•  í€µë©”ëª¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    if (confirm("ì„ íƒí•œ í€µë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      quickmemos.splice(selectedQuickmemoIndex, 1);
      selectedQuickmemoIndex = null;
      localStorage.setItem('quickmemos', JSON.stringify(quickmemos));
      renderQuickmemoList();
      sermonContent.value = "";
      updateAISuggestion("");
      alert("í€µë©”ëª¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
  };

  // ìŒì„± ì¸ì‹ ê¸°ëŠ¥
  let recognition;
  let recognizing = false;
  micBtn.addEventListener('click', () => {
    if(!('webkitSpeechRecognition' in window)) {
      alert('ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. í¬ë¡¬ì—ì„œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
      return;
    }
    if(recognizing) {
      recognition.stop();
      return;
    }
    recognition = new webkitSpeechRecognition();
    recognition.lang = 'ko-KR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.onstart = () => {
      recognizing = true;
      micBtn.classList.add('active');
    };
    recognition.onend = () => {
      recognizing = false;
      micBtn.classList.remove('active');
    };
    recognition.onerror = (event) => {
      alert('ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ' + event.error);
      recognizing = false;
      micBtn.classList.remove('active');
    };
    recognition.onresult = (event) => {
      sermonContent.value += event.results[0][0].transcript;
      updateAISuggestion(sermonContent.value);
    };
    recognition.start();
  });

  // AI ì¶”ì²œ (OpenAI ì—°ë™ ì˜ˆì‹œ - ë°°í¬ëœ Firebase Functions ì£¼ì†Œë¡œ ë³€ê²½ë¨)
  async function fetchAISummary(text) {
    console.log('fetchAISummary í˜¸ì¶œ:', text);
    if (!text) {
      aiSuggestion.textContent = "ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
      return;
    }
    aiSuggestion.textContent = "AI ì¶”ì²œ ìƒì„± ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.";
    try {
      const res = await fetch('https://us-central1-sermonnote-live.cloudfunctions.net/generateExamples', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ prompt: text }),
      });
      const data = await res.json();
      if (data.result) {
        aiSuggestion.textContent = data.result;
      } else {
        aiSuggestion.textContent = "AI ì¶”ì²œì´ ì—†ìŠµë‹ˆë‹¤.";
      }
    } catch (error) {
      aiSuggestion.textContent = "AI í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      console.error(error);
    }
  }

  let aiTimeout;
  function updateAISuggestion(text) {
    console.log('updateAISuggestion í˜¸ì¶œ:', text);
    if (aiTimeout) clearTimeout(aiTimeout);
    aiSuggestion.textContent = "AI ì¶”ì²œ ëŒ€ê¸° ì¤‘...";
    aiTimeout = setTimeout(() => {
      fetchAISummary(text.trim());
    }, 1500);
  }

  sermonContent.addEventListener('input', () => updateAISuggestion(sermonContent.value));

  updateAISuggestion("");
</script>

</body>
</html>
