<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ììœ  í˜•ì‹ ì„¤êµ ì‘ì„±ê¸° (ëª©íšŒììš©)</title>
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      background: linear-gradient(135deg, #1c1c2b, #28313b);
      margin: 0;
      color: #f0e6d2;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
      min-height: 100vh;
      padding: 40px 20px; /* ìƒí•˜ì¢Œìš° íŒ¨ë”© ì¶”ê°€ */
      box-sizing: border-box;
    }
    .container {
      display: flex;
      flex-wrap: wrap; /* ë°˜ì‘í˜•ì„ ìœ„í•´ ì¤„ë°”ê¿ˆ í—ˆìš© */
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      max-width: 1200px; /* ì „ì²´ ë„ˆë¹„ ì¦ê°€ */
      width: 100%;
      gap: 20px; /* ì»¬ëŸ¼ ê°„ ê°„ê²© */
      box-sizing: border-box;
    }
    .column {
      flex: 1;
      min-width: 380px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }
    .column.left {
      max-width: 450px; /* ì™¼ìª½ ì»¬ëŸ¼ ë„ˆë¹„ ì œí•œ */
    }
    .column.right {
      flex: 2; /* ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ ë” ë„“ê²Œ */
      background: linear-gradient(to bottom, #fff 29px, #f0f0f0 30px),
                  url('https://www.transparenttextures.com/patterns/lined-paper.png');
      background-size: 100% 30px;
      background-repeat: repeat-y;
      color: #333; /* ë…¸íŠ¸ ë°°ê²½ì— ë§ì¶° í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h2 {
      color: #222;
      text-align: center;
      margin-bottom: 25px;
      font-size: 2.2rem;
    }
    label {
      color: #222;
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
      margin-top: 15px;
      font-size: 1.1rem;
      text-align: left;
    }
    input[type="text"], textarea, select { /* select íƒœê·¸ë„ ìŠ¤íƒ€ì¼ ì ìš© */
      width: calc(100% - 24px); /* íŒ¨ë”© ê³ ë ¤ */
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      box-sizing: border-box;
      background-color: #fff;
      color: #222;
    }
    textarea {
      line-height: 30px;
      min-height: 150px;
      resize: vertical;
      background: transparent; /* ë¶€ëª¨ ì»¬ëŸ¼ ë°°ê²½ì´ ë³´ì´ë„ë¡ íˆ¬ëª… ì„¤ì • */
      box-shadow: none; /* ê¸°ì¡´ ê·¸ë¦¼ì ì œê±° (ë¶€ëª¨ê°€ ê´€ë¦¬) */
    }
    #sermonOutput { /* ì„¤êµ ì¶œë ¥ ì˜ì—­ì€ ê·¸ëŒ€ë¡œ ë…¸íŠ¸ ë°°ê²½ ìœ ì§€ */
      min-height: 250px;
      padding: 20px;
      margin-top: 25px;
      text-align: left;
      white-space: pre-wrap; /* ì¤„ ë°”ê¿ˆ ìœ ì§€ */
      border: 1px solid #ddd;
      line-height: 1.6;
    }
    #hymnRecommendationOutput { /* ì°¬ì†¡ê°€ ì¶”ì²œ ì˜ì—­ */
        background: #eee;
        color: #222;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: left;
        min-height: 60px;
        white-space: pre-wrap;
        border: 1px solid #ddd;
        font-size: 0.95rem;
    }
    .button-group {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      background: #ffea00;
      color: #222;
      cursor: pointer;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
    }
    button:hover:not(:disabled) {
      background: #fff176;
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.3);
    }
    button:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    #micBtn { /* ìŒì„± ì…ë ¥ ë²„íŠ¼ */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      vertical-align: middle;
      background: #ff5252;
      color: white;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      margin-left: 10px;
      box-shadow: 0 4px 8px rgba(255, 82, 82, 0.4);
    }
    #micBtn.active {
      background: #e00000;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%   { box-shadow: 0 0 0 0 rgba(244,67,54,0.7); }
      70%  { box-shadow: 0 0 0 15px rgba(244,67,54,0); }
      100% { box-shadow: 0 0 0 0 rgba(244,67,54,0); }
    }
    .message-box {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #fff;
      background-color: #555;
      text-align: center;
    }
    .message-box.loading { background-color: #4a90e2; }
    .message-box.error { background-color: #d0021b; }
    .message-box.warning { background-color: #f5a623; }
    .message-box.info { background-color: #333; }
    .message-box.success { background-color: #4CAF50; }
  </style>
</head>
<body>
  <div class="container">
    <div class="column left">
      <h2>âœ ì„¤êµ ìš”ì²­ ì…ë ¥</h2>
      
      <label for="sermonAudience">1. ì„¤êµ ëŒ€ìƒ</label>
      <select id="sermonAudience">
        <option value="ì£¼ì¼ëŒ€ì˜ˆë°°">ì£¼ì¼ëŒ€ì˜ˆë°°</option>
        <option value="ìˆ˜ìš”ì˜ˆë°°">ìˆ˜ìš”ì˜ˆë°°</option>
        <option value="ì²­ë…„ëŒ€í•™ë¶€">ì²­ë…„ëŒ€í•™ë¶€</option>
        <option value="ì¤‘ê³ ë“±ë¶€">ì¤‘ê³ ë“±ë¶€</option>
        <option value="ì´ˆë“±ë¶€">ì´ˆë“±ë¶€</option>
        <option value="ìƒˆë²½ê¸°ë„">ìƒˆë²½ê¸°ë„</option>
        <option value="ì‹¬ë°©ì˜ˆë°°">ì‹¬ë°©ì˜ˆë°°</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
      
      <label for="sermonDuration">2. ì„¤êµ ì‹œê°„</label>
      <select id="sermonDuration">
        <option value="15ë¶„">15ë¶„</option>
        <option value="20ë¶„">20ë¶„</option>
        <option value="30ë¶„">30ë¶„</option>
        <option value="40ë¶„">40ë¶„</option>
        <option value="ììœ ë¡­ê²Œ">ììœ ë¡­ê²Œ</option>
      </select>

      <label for="topicInput">3. ì„¤êµ ì£¼ì œ ë˜ëŠ” ì„±ê²½ ë³¸ë¬¸</label>
      <input type="text" id="topicInput" placeholder="ì˜ˆ: ìš”í•œë³µìŒ 3:16 ë˜ëŠ” 'í•˜ë‚˜ë‹˜ì˜ ì‚¬ë‘'">
      
      <label for="instructionsTextarea">4. ì›í•˜ëŠ” ì„¤êµ ë°©í–¥ ë˜ëŠ” ìš”ì²­ì‚¬í•­</label>
      <textarea id="instructionsTextarea" placeholder="ì˜ˆ: ì§§ì€ ì˜ˆí™” 1ê°œ í¬í•¨, ì ìš©ì  3ê°œ ê°•ì¡°, ë¹„ìœ  ì‚¬ìš© ë“±"></textarea>

      <div class="button-group">
        <button id="generateSermonBtn">ğŸ§  AI ì„¤êµ ìƒì„±</button>
        <button id="micBtn">ğŸ¤ ìŒì„± ì…ë ¥</button>
      </div>
      <div id="messageOutput" class="message-box">ì„¤êµ ìƒì„±ì„ ìœ„í•œ ìš”ì²­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

    </div>

    <div class="column right">
      <h2>ğŸ“– ìƒì„±ëœ ì„¤êµë¬¸</h2>
      <div id="sermonOutput">âœï¸ ìƒì„±ëœ ì„¤êµë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
      
      <div class="button-group">
        <button id="recommendHymnsBtn">ğŸµ ê´€ë ¨ ì°¬ì†¡ê°€ ì¶”ì²œ</button> <!-- ì°¬ì†¡ê°€ ì¶”ì²œ ë²„íŠ¼ -->
        <button id="savePDFBtn">ğŸ“„ PDF ì €ì¥</button>
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
        <button id="clearContentBtn">ğŸ§¼ ë‚´ìš© ì´ˆê¸°í™”</button>
      </div>

      <label for="hymnRecommendationOutput" style="margin-top:20px;">ğŸµ ì¶”ì²œ ì°¬ì†¡ê°€</label>
      <div id="hymnRecommendationOutput" class="message-box">ì¶”ì²œ ì°¬ì†¡ê°€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const backendUrl = 'http://localhost:3000'; // ë°±ì—”ë“œ ì„œë²„ ì£¼ì†Œ

    // --- DOM ìš”ì†Œ ì°¸ì¡° ---
    const sermonAudience = document.getElementById('sermonAudience');
    const sermonDuration = document.getElementById('sermonDuration');
    const topicInput = document.getElementById('topicInput');
    const instructionsTextarea = document.getElementById('instructionsTextarea');
    const generateSermonBtn = document.getElementById('generateSermonBtn');
    const micBtn = document.getElementById('micBtn');
    const messageOutput = document.getElementById('messageOutput');
    const sermonOutput = document.getElementById('sermonOutput');
    const recommendHymnsBtn = document.getElementById('recommendHymnsBtn'); // ì°¬ì†¡ê°€ ì¶”ì²œ ë²„íŠ¼
    const hymnRecommendationOutput = document.getElementById('hymnRecommendationOutput'); // ì°¬ì†¡ê°€ ì¶”ì²œ ì¶œë ¥ ì˜ì—­
    const savePDFBtn = document.getElementById('savePDFBtn');
    const clearContentBtn = document.getElementById('clearContentBtn');

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

    // UI ìš”ì†Œ í™œì„±í™”/ë¹„í™œì„±í™”
    function setUIState(disabled) {
        const interactiveElements = [
            sermonAudience, sermonDuration, topicInput, instructionsTextarea,
            generateSermonBtn, micBtn, recommendHymnsBtn,
            savePDFBtn, clearContentBtn
        ];
        interactiveElements.forEach(el => el.disabled = disabled);
    }

    // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
    function displayMessage(element, message, type = 'info') {
        element.textContent = message;
        element.className = 'message-box ' + type;
    }

    // --- API í˜¸ì¶œ í•¨ìˆ˜ ---

    // AIì—ê²Œ ì„¤êµ ìƒì„±ì„ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
    async function generateCustomSermon() {
      const audience = sermonAudience.value;
      const duration = sermonDuration.value;
      const topic = topicInput.value.trim();
      const instructions = instructionsTextarea.value.trim();
      
      if (!topic && !instructions) {
        displayMessage(messageOutput, "â— ì„¤êµ ì£¼ì œë‚˜ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'warning');
        return;
      }

      displayMessage(messageOutput, "ğŸ§  AIê°€ ì„¤êµë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...", 'loading');
      sermonOutput.textContent = 'AIê°€ ì„¤êµë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...'; // ì´ì „ ë‚´ìš© ì§€ìš°ê¸° ë° ë¡œë”© ë©”ì‹œì§€
      hymnRecommendationOutput.textContent = 'ì¶”ì²œ ì°¬ì†¡ê°€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.'; // ì°¬ì†¡ê°€ ì´ˆê¸°í™”
      hymnRecommendationOutput.className = 'message-box info'; // ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      setUIState(true); // UI ë¹„í™œì„±í™”

      const prompt = `
ì„¤êµ ëŒ€ìƒ: ${audience}
ì„¤êµ ì‹œê°„: ${duration}
ì„¤êµ ì£¼ì œ/ë³¸ë¬¸: ${topic || "ì—†ìŒ"}
ìš”ì²­ ì‚¬í•­: ${instructions || "ì—†ìŒ"}

ìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì„¤êµ ëŒ€ìƒê³¼ ì‹œê°„ì— ë§ì¶° ê¸°ë…êµ ì„¤êµë¬¸ì„ ì‘ì„±í•´ì¤˜. ì„œë¡ , ë³¸ë¡ (ì†Œì£¼ì œ 3ê°œ), ê²°ë¡ ì„ í¬í•¨í•˜ê³ , ì„±ê²½ì ì´ë©° ì‹¤ì²œì ì¸ ë©”ì‹œì§€ë¥¼ ë‹´ì•„ì¤˜.
`;
      const systemPrompt = "ë‹¹ì‹ ì€ ê¸°ë…êµ ì„¤êµë¬¸ ì‘ì„± ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë‹¤ì–‘í•œ ìš”ì²­ê³¼ ì£¼ì œì— ë§ì¶° ì°½ì˜ì ì´ê³  ê°ë™ì ì¸ ì„¤êµë¬¸ì„ ì‘ì„±í•©ë‹ˆë‹¤.";

      try {
        const response = await fetch(`${backendUrl}/api/ai-process`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, systemPrompt, bibleReference: topic }) // ì„±ê²½ êµ¬ì ˆì´ ìˆë‹¤ë©´ ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì „ë‹¬
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || response.statusText);
        }

        const data = await response.json();
        sermonOutput.textContent = data.content;
        displayMessage(messageOutput, "âœ… AI ì„¤êµ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
      } catch (error) {
        displayMessage(messageOutput, "âŒ ì„¤êµ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + error.message, 'error');
        console.error("Generate Sermon Error:", error);
      } finally {
        setUIState(false); // UI í™œì„±í™”
      }
    }

    // --- ì°¬ì†¡ê°€ ì¶”ì²œ ê¸°ëŠ¥ (ìƒˆë¡œ ì¶”ê°€) ---
    async function recommendHymns() {
        const sermonText = sermonOutput.textContent.trim();
        if (!sermonText || sermonText.includes('ìƒì„±ëœ ì„¤êµë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤') || sermonText.includes('AIê°€ ì„¤êµë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤')) {
            displayMessage(hymnRecommendationOutput, 'â— ì°¬ì†¡ê°€ ì¶”ì²œì„ ë°›ìœ¼ë ¤ë©´ ë¨¼ì € ì„¤êµë¬¸ì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'warning');
            return;
        }

        displayMessage(hymnRecommendationOutput, 'ğŸµ AIê°€ ì°¬ì†¡ê°€ë¥¼ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤...', 'loading');
        setUIState(true);

        const prompt = `ë‹¤ìŒ ì„¤êµë¬¸ì˜ ë‚´ìš©ê³¼ ë¶„ìœ„ê¸°ì— ì–´ìš¸ë¦¬ëŠ” ì°¬ì†¡ê°€ 3ê³¡ì„ ì¶”ì²œí•´ì¤˜. ê° ì°¬ì†¡ê°€ì˜ ì œëª©ê³¼ ë²ˆí˜¸(ìˆë‹¤ë©´), ê·¸ë¦¬ê³  ê°„ëµí•˜ê²Œ ì¶”ì²œ ì´ìœ ë¥¼ í¬í•¨í•´ì¤˜:\n\n"${sermonText}"`;
        const systemPrompt = "ë‹¹ì‹ ì€ ì„¤êµ ë‚´ìš©ì— ë§ëŠ” ì°¬ì†¡ê°€ë¥¼ ì¶”ì²œí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê¸°ë…êµ ì°¬ì†¡ê°€ ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ì ì ˆí•œ ê³¡ì„ ì œì•ˆí•©ë‹ˆë‹¤.";

        try {
            const response = await fetch(`${backendUrl}/api/ai-process`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, systemPrompt })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || response.statusText);
            }

            const data = await response.json();
            displayMessage(hymnRecommendationOutput, data.content, 'info'); // 'info' ìŠ¤íƒ€ì¼ë¡œ ì¼ë°˜ í…ìŠ¤íŠ¸ ì¶œë ¥
        } catch (error) {
            displayMessage(hymnRecommendationOutput, 'âŒ ì°¬ì†¡ê°€ ì¶”ì²œ ì˜¤ë¥˜: ' + error.message, 'error');
            console.error("Hymn Recommendation Error:", error);
        } finally {
            setUIState(false);
        }
    }


    // --- ìŒì„± ì…ë ¥ ê¸°ëŠ¥ ---
    function startMic() {
      const focusedElement = document.activeElement; // í˜„ì¬ í¬ì»¤ìŠ¤ëœ ìš”ì†Œ
      
      // í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ(textarea ë˜ëŠ” input[type="text"])ì—ë§Œ ì ìš©
      if (focusedElement && (focusedElement.tagName === 'TEXTAREA' || (focusedElement.tagName === 'INPUT' && focusedElement.type === 'text'))) {
        if (!('webkitSpeechRecognition' in window)) {
            displayMessage(messageOutput, 'âš ï¸ í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ìŒì„± ì…ë ¥ì´ ì§€ì›ë©ë‹ˆë‹¤.', 'warning');
            return;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'ko-KR'; // í•œêµ­ì–´ ì„¤ì •
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = () => {
            micBtn.classList.add('active');
            displayMessage(messageOutput, 'ğŸ¤ ìŒì„± ì…ë ¥ì„ ì‹œì‘í•©ë‹ˆë‹¤. ë§ì”€í•˜ì„¸ìš”...', 'info');
            // focusedElement.value = ''; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê³  ì‹œì‘ (ì„ íƒ ì‚¬í•­)
        };
        recognition.onend = () => {
            micBtn.classList.remove('active');
            displayMessage(messageOutput, 'ìŒì„± ì…ë ¥ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        };
        recognition.onerror = (event) => {
            displayMessage(messageOutput, 'âŒ ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ' + event.error, 'error');
            console.error('Speech Recognition Error:', event.error);
            micBtn.classList.remove('active');
        };
        recognition.onresult = (event) => {
            const text = event.results[0][0].transcript;
            focusedElement.value += (focusedElement.value ? '\nâ€” ' : '') + text; // ê¸°ì¡´ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì¤„ë°”ê¿ˆ ì¶”ê°€
            displayMessage(messageOutput, 'âœ… ìŒì„± ì…ë ¥ ì™„ë£Œ: "' + text + '"', 'info');
        };
        
        recognition.start();
      } else {
          displayMessage(messageOutput, "ìŒì„± ì…ë ¥ì„ ì‹œì‘í•˜ë ¤ë©´ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì— ì»¤ì„œë¥¼ ë‘ì„¸ìš”.", 'warning');
      }
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
    generateSermonBtn.addEventListener('click', generateCustomSermon);
    micBtn.addEventListener('click', startMic);
    recommendHymnsBtn.addEventListener('click', recommendHymns); // ì°¬ì†¡ê°€ ì¶”ì²œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ

    savePDFBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const content = sermonOutput.textContent.trim();
        const hymnContent = hymnRecommendationOutput.textContent.trim();

        let fullContent = '';
        if (content && !content.includes('ìƒì„±ëœ ì„¤êµë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤') && !content.includes('AIê°€ ì„¤êµë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤')) {
            fullContent += `--- ì„¤êµë¬¸ ---\n${content}\n\n`;
        }
        if (hymnContent && !hymnContent.includes('ì¶”ì²œ ì°¬ì†¡ê°€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤') && !hymnContent.includes('AIê°€ ì°¬ì†¡ê°€ë¥¼ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤') && !hymnContent.includes('ì°¬ì†¡ê°€ ì¶”ì²œì„ ë°›ìœ¼ë ¤ë©´')) {
            fullContent += `--- ì¶”ì²œ ì°¬ì†¡ê°€ ---\n${hymnContent}\n\n`;
        }


        if (!fullContent) {
            displayMessage(messageOutput, 'â— ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            return;
        }
        
        // í•œê¸€ í°íŠ¸ ë¬¸ì œ í•´ê²°ì€ jspdf-autotableê³¼ ì»¤ìŠ¤í…€ í°íŠ¸ ë¡œë”© í•„ìš”
        // ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ í°íŠ¸ ì‚¬ìš© (í•œê¸€ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ)
        const lines = doc.splitTextToSize(fullContent, 180);
        doc.text(lines, 10, 10);
        doc.save('ììœ í˜•ì‹_ì„¤êµë¬¸.pdf');
        displayMessage(messageOutput, 'âœ… ì„¤êµë¬¸ì´ PDFë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    });

    clearContentBtn.addEventListener('click', () => {
      if (confirm('ì •ë§ë¡œ ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { // confirmë„ ì‚¬ìš©ì ì •ì˜ ë©”ì‹œì§€ ë°•ìŠ¤ ê¶Œì¥
        topicInput.value = '';
        instructionsTextarea.value = '';
        sermonOutput.textContent = 'âœï¸ ìƒì„±ëœ ì„¤êµë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤';
        hymnRecommendationOutput.textContent = 'ì¶”ì²œ ì°¬ì†¡ê°€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
        displayMessage(messageOutput, 'ëª¨ë“  ë‚´ìš©ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        hymnRecommendationOutput.className = 'message-box info'; // ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      }
    });

    // ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì •
    window.onload = () => {
      displayMessage(messageOutput, 'ì„¤êµ ìƒì„±ì„ ìœ„í•œ ìš”ì²­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'info');
      displayMessage(hymnRecommendationOutput, 'ì¶”ì²œ ì°¬ì†¡ê°€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.', 'info'); // ì´ˆê¸° ë©”ì‹œì§€
    };
  </script>
</body>
</html>
