<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>퀵메모</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Nanum Gothic', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .memo-container {
      background: #222;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 255, 100, 0.3);
      padding: 24px;
      max-width: 600px;
      width: 100%;
      margin-top: 60px;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      font-size: 1.1rem;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px;
      resize: vertical;
      margin-bottom: 8px;
    }
    .char-count {
      font-size: 0.9rem;
      color: #ccc;
      text-align: right;
      margin-bottom: 8px;
    }
    .btn-row {
      display: flex;
      gap: 10px;
      justify-content: space-between;
    }
    button {
      background: #ffea00;
      color: #000;
      font-weight: bold;
      font-size: 1.1rem;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #fff176;
    }
    .memo-list {
      margin-top: 30px;
      background: #2a2a2a;
      padding: 16px;
      border-radius: 10px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }
    .memo-item {
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 8px;
    }
    .memo-controls {
      margin-top: 4px;
    }
    .memo-controls button {
      font-size: 0.9rem;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <h2>✍ 퀵메모</h2>
  <div class="memo-container">
    <textarea id="memoInput" maxlength="20" placeholder="메모를 입력하세요 (20자 이내)" oninput="updateCharCount()"></textarea>
    <div class="char-count" id="charCount">0 / 20</div>
    <div class="btn-row">
      <button onclick="startSpeech()">🎤 음성입력</button>
      <button onclick="saveMemo()">저장</button>
    </div>
  </div>
  <div class="memo-list" id="memoList"></div>

  <script>
    let editingIndex = -1;

    function saveMemo() {
      const memoInput = document.getElementById('memoInput');
      const text = memoInput.value.trim();
      if (!text) return;
      const today = new Date().toLocaleDateString();
      let saved = JSON.parse(localStorage.getItem('memos') || '[]');

      const todayCount = saved.filter(m => new Date(m.date).toLocaleDateString() === today).length;
      if (editingIndex === -1 && todayCount >= 10) {
        alert('하루 최대 10개의 메모만 작성할 수 있습니다.');
        return;
      }

      if (editingIndex >= 0) {
        saved[editingIndex].text = text;
        saved[editingIndex].date = new Date().toLocaleString();
        editingIndex = -1;
      } else {
        saved.unshift({ text, date: new Date().toLocaleString() });
      }
      localStorage.setItem('memos', JSON.stringify(saved));
      memoInput.value = '';
      updateCharCount();
      renderMemos();
    }

    function deleteMemo(index) {
      let saved = JSON.parse(localStorage.getItem('memos') || '[]');
      saved.splice(index, 1);
      localStorage.setItem('memos', JSON.stringify(saved));
      renderMemos();
    }

    function editMemo(index) {
      let saved = JSON.parse(localStorage.getItem('memos') || '[]');
      document.getElementById('memoInput').value = saved[index].text;
      editingIndex = index;
      updateCharCount();
    }

    function renderMemos() {
      const memoList = document.getElementById('memoList');
      let saved = JSON.parse(localStorage.getItem('memos') || '[]');
      saved.sort((a, b) => new Date(b.date) - new Date(a.date));

      memoList.innerHTML = saved.map((memo, index) => `
        <div class="memo-item">
          <div>📝 ${memo.text}</div>
          <small style="color:#aaa">${memo.date}</small>
          <div class="memo-controls">
            <button onclick="editMemo(${index})">✏ 수정</button>
            <button onclick="deleteMemo(${index})">🗑 삭제</button>
          </div>
        </div>
      `).join('');
    }

    function startSpeech() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("음성인식을 지원하지 않는 브라우저입니다. 크롬 또는 웨일을 사용하세요.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'ko-KR';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.onresult = function(event) {
        const current = document.getElementById('memoInput').value;
        const transcript = event.results[0][0].transcript;
        const combined = (current + transcript).slice(0, 20);
        document.getElementById('memoInput').value = combined;
        updateCharCount();
      };
      recognition.onerror = function() {
        alert("음성인식에 실패했습니다. 다시 시도해 주세요.");
      };
      recognition.start();
    }

    function updateCharCount() {
      const currentLength = document.getElementById('memoInput').value.length;
      document.getElementById('charCount').textContent = `${currentLength} / 20`;
    }

    renderMemos();
  </script>
</body>
</html>
